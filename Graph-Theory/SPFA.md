## å†™åœ¨å‰é¢

ç”±äºæœ¬äººå®åŠ›å°šæµ…ï¼Œæ¥è§¦ç®—æ³•æ²¡å¤šä¹…ï¼Œå†™è¿™ç¯‡blogä»…ä»…æ˜¯æƒ³è¦æå‡è‡ªå·±å¯¹ç®—æ³•çš„ç†è§£ï¼Œå¦‚æœå„ä½è¯»è€…å‘ç°ä»€ä¹ˆé”™è¯¯ï¼Œæ³è¯·æ–§æ­£ï¼Œå¸Œæœ›å’Œå¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚(â—'â—¡'â—)

## é¢˜ç›®

![spfaé¢˜ç›®](https://img-blog.csdnimg.cn/direct/1bc68f5d4a754360a5a3625c2878d1bc.png#pic_center)

## æ€è·¯

1. æ ¹æ®ä¸Šä¸€ç¯‡å…³äºbellman_fordåˆ†æçš„blogï¼ˆä¸äº†è§£ï¼Ÿâ€”>[ä¼ é€é—¨](https://blog.csdn.net/yourgrandfather_/article/details/134935786))æˆ‘ä»¬çŸ¥é“bellman_fordçš„è§£æ³•å¤ªæš´åŠ›äº†ï¼Œæ¯æ¬¡éƒ½éå†æ‰€æœ‰çš„è¾¹ï¼Œèªæ˜çš„ä½ è‚¯å®šæƒ³åˆ°äº†ï¼Œå…¶å®bellman_fordç®—æ³•ä¸­å¾ˆå¤šæ¬¡æ¾å¼›æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºåªæœ‰å½“ä¸€ä¸ªç‚¹çš„å‰é©±ç»“ç‚¹è·ç¦»æ›´æ–°æ—¶ï¼Œé‚£ä¹ˆè¯¥ç»“ç‚¹æ‰æœ‰å¯èƒ½æ›´æ–°ï¼ˆåªæ˜¯æœ‰å¯èƒ½ï¼Œä¸ä¸€å®šä¼šæ›´æ–°ï¼‰ã€‚
2. æƒ³åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸€ä¸ªé˜Ÿåˆ—`queue`æ¥å­˜å‚¨æ¯æ¬¡çš„æ›´æ–°çš„é¡¶ç‚¹ã€‚å…ˆå°†æºç‚¹å‹å…¥é˜Ÿåˆ—ã€‚
3. åªè¦é˜Ÿåˆ—ä¸ç©ºï¼Œæˆ‘ä»¬å°±å–å‡ºé˜Ÿå¤´ï¼Œéå†å®ƒçš„æ‰€æœ‰è¾¹ï¼Œä¾æ¬¡æ›´æ–°ä¸å®ƒç›¸è¿çš„ç‚¹è·ç¦»æºç‚¹çš„è·ç¦»ã€‚å¦‚æœè¯¥é¡¶ç‚¹è·ç¦»æºç‚¹çš„è·ç¦»è¢«æ›´æ–°ï¼Œå°†å®ƒå…¥é˜Ÿã€‚
   
   ## ä»£ç 

```cpp
//ä¸€äº›æ•°ç»„çš„å«ä¹‰è¯´æ˜
int e[N],ne[N],h[N],w[N];        //å»ºç«‹é‚»æ¥è¡¨
int d[N];        //å­˜å‚¨æ¯ä¸€ä¸ªé¡¶ç‚¹è·ç¦»æºç‚¹çš„è·ç¦»ï¼Œåˆå§‹åŒ–ä¸ºINF
int st[N];        //è®°å½•æ¯ä¸€ä¸ªé¡¶ç‚¹æ˜¯å¦åœ¨é˜Ÿåˆ—ä¸­ï¼Œ1è¡¨ç¤ºåœ¨é˜Ÿåˆ—ä¸­ï¼Œ0è¡¨ç¤ºä¸åœ¨é˜Ÿåˆ—ä¸­
```

```cpp
#include<iostream>
#include<cstring>
#include<queue>

using namespace std;
const int N=100010;
int n,m;
int e[N],ne[N],h[N],w[N],d[N],st[N],idx;

void add(int a,int b,int c)
{
    e[idx]=b,ne[idx]=h[a],w[idx]=c,h[a]=idx++;
}

void spfa()
{
    queue<int> q;       
    q.push(1);      //å°†æºç‚¹å‹å…¥é˜Ÿåˆ—
    d[1]=0;         //åŒæ—¶å°†æºç‚¹è·ç¦»è‡ªå·±æœ¬èº«çš„è·ç¦»ç½®ä¸º0
    st[1]=1;        //ç”±äºæºç‚¹å·²ç»å…¥é˜Ÿï¼Œæ‰€ä»¥æºç‚¹çš„çŠ¶æ€ç½®ä¸º1
    while(!q.empty())       //åªè¦é˜Ÿåˆ—ä¸ç©ºï¼Œå°±ä¸€ç›´å¾ªç¯ä¸‹å»
    {
        int t=q.front();
        q.pop();
        st[t]=0;        //ç”±äºå·²ç»å°†è¯¥é¡¶ç‚¹å–å‡ºæ²ªï¼Œæ‰€ä»¥åˆå°†è¯¥ç‚¹çš„çŠ¶æ€ç½®ä¸º0ï¼Œæ–¹ä¾¿åç»­å†æ¬¡å…¥é˜Ÿ
        for(int i=h[t];i!=-1;i=ne[i])       //éå†ä¸è¯¥é¡¶ç‚¹ç›¸è¿çš„æ‰€æœ‰é¡¶ç‚¹
        {
            int j=e[i];
            if(d[j]>d[t]+w[i])      
            {
                d[j]=d[t]+w[i];
                if(!st[j])
                {
                    st[j]=1;
                    q.push(j);      //å¦‚æœè·ç¦»è¢«æ›´æ–°ä¸”è¯¥ç‚¹ä¸åœ¨é˜Ÿåˆ—ä¸­ï¼Œå°±å°†è¯¥ç‚¹å‹å…¥é˜Ÿåˆ—
                }
            }
        }
    }
}

int main()
{
    cin>>n>>m;
    memset(h,-1,sizeof h);      //é‚»æ¥è¡¨çš„åˆå§‹åŒ–
    memset(d,0x3f,sizeof d);        //è·ç¦»æ•°ç»„çš„åˆå§‹åŒ–
    while(m--)
    {
        int a,b,c;
        cin>>a>>b>>c;
        add(a,b,c);
    }

    spfa();
    if(d[n]==0x3f3f3f3f)
        cout<<"impossible"<<endl;
    else
        cout<<d[n]<<endl;
    return 0;
}
```

## è¯´æ˜

1. `st[]`æ•°ç»„å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œæ²¡æœ‰å®ƒä¹Ÿå¯ä»¥ï¼Œåªä¸è¿‡è¿è¡Œæ—¶é—´ä¼šæ…¢ä¸€ç‚¹ã€‚å› ä¸º`st[]`çš„æ„ä¹‰å°±æ˜¯é˜²æ­¢å°†å·²ç»åœ¨é˜Ÿåˆ—ä¸­çš„ç‚¹å†æ¬¡å…¥é˜Ÿï¼Œæå‡ä»£ç è¿è¡Œæ•ˆç‡ã€‚
2. `SPFA`ç®—æ³•ä¸èƒ½ç”¨æ¥æ±‚è§£å«æœ‰è´Ÿæƒå›è·¯çš„å›¾ã€‚å› ä¸ºå¦‚æœæœ‰è´Ÿæƒå›è·¯ï¼Œé‚£ä¹ˆè´Ÿæƒå›è·¯ä¸­çš„é¡¶ç‚¹è·ç¦»æºç‚¹çš„è·ç¦»ä¼šä¸æ–­è¢«æ›´æ–°ï¼Œå› æ­¤è¿™äº›é¡¶ç‚¹ä¹Ÿä¼šä¸æ–­åœ°å…¥é˜Ÿå†å‡ºé˜Ÿï¼Œå½¢æˆä¸€ä¸ªæ­»å¾ªç¯ã€‚ï¼ˆå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥å€ŸåŠ©`SPFA`æ¥åˆ¤æ–­ä¸€ä¸ªå›¾ä¸­æ˜¯å¦å«æœ‰è´Ÿæƒå›è·¯ï¼Œæˆ‘ä¸€ä¼šåœ¨åé¢ä¼šå†™åˆ°çš„ï¼‰
   
   ## æ‹“å±•
   
   #### åˆ©ç”¨`SPFA`æ¥åˆ¤æ–­é€”ä¸­æ˜¯å¦å«æœ‰è´Ÿæƒå›è·¯ï¼Œå…ˆçœ‹ä¸‹é¢çš„é¢˜ã€‚
   
   ![spfaåˆ¤æ–­è´Ÿæƒå›è·¯](https://img-blog.csdnimg.cn/direct/9366cbc7e01e4caeb33e6b602c387862.png#pic_center)
   
   #### æ€è·¯
3. å¤§è‡´æ€è·¯å’Œå‰é¢`SPFA`æ€è·¯å·®ä¸å¤šï¼Œå°±æ˜¯å¼•å…¥äº†`cnt[]`æ•°ç»„ï¼Œ`cnt[]`æ•°ç»„æ˜¯ç”¨æ¥è®°å½•å„ä¸ªé¡¶ç‚¹åˆ°è¾¾æºç‚¹çš„æœ€çŸ­è·ç¦»è¦ç»è¿‡çš„é¡¶ç‚¹çš„æ•°é‡ï¼ˆå¦‚æœè¯¥é¡¶ç‚¹`i`å’Œæºç‚¹è”é€šçš„è¯`cnt[i]`å°±ä¸ä¸º0ï¼Œå¦‚æœä¸è¿é€šå°±ä¸€ç›´ä¸º0ï¼‰å…³äº`cnt[]`ç†è§£èµ·æ¥å¯èƒ½æœ‰äº›å›°éš¾ï¼Œä¸€ä¼šé…åˆç€çœ‹ä»£ç å¯èƒ½è¦å¥½ç†è§£ä¸€äº›ğŸ˜Š
   
   #### ä»£ç 

```cpp
#include<iostream>
#include<cstring>
#include<queue>

using namespace std;
const int N=100010;
int n,m;
int e[N],ne[N],h[N],w[N],d[N],st[N],cnt[N],idx;

void add(int a,int b,int c)
{
    e[idx]=b,ne[idx]=h[a],w[idx]=c,h[a]=idx++;
}

bool spfa()
{
    queue<int> q;
    for(int i=1;i<=n;i++)       //ä¸€å¼€å§‹å°†æ‰€æœ‰é¡¶ç‚¹å‹å…¥é˜Ÿåˆ—
    {
        q.push(i);
        st[i]=1;
    }
    d[1]=0;
    while(!q.empty())       //é˜Ÿåˆ—ä¸ä¸ºç©º
    {
        int t=q.front();
        q.pop();
        st[t]=0;
        for(int i=h[t];i!=-1;i=ne[i])       //å’Œä¹‹å‰spfaåšæ³•ä¸€æ¨¡ä¸€æ ·
        {
            int j=e[i];
            if(d[j]>d[t]+w[i])
            {
                d[j]=d[t]+w[i];
                cnt[j]=cnt[t]+1;        //è¿™ä¸ªè¡¨ç¤ºæºç‚¹åˆ°é¡¶ç‚¹jç»è¿‡cnt[t]+1ä¸ªé¡¶ç‚¹
                if(cnt[j]>=n)       //å¦‚æœç»è¿‡çš„é¡¶ç‚¹å¤§äºæ‰€æœ‰é¡¶ç‚¹æ•°ï¼Œé‚£ä¹ˆå°±è¯´æ˜å«æœ‰è´Ÿæƒå›è·¯
                    return false;
                if(!st[j])
                {
                    st[j]=1;
                    q.push(j);
                }
            }
        }
    }
    return true;        //å¦‚æœæœ€åå¯ä»¥è·³å‡ºå¾ªç¯ï¼Œå°±è¯´æ˜æ²¡æœ‰è´Ÿæƒå›è·¯
}

int main()
{
    cin>>n>>m;
    memset(h,-1,sizeof h);
    memset(d,0x3f,sizeof d);
    while(m--)
    {
        int a,b,c;
        cin>>a>>b>>c;
        add(a,b,c);
    }

    if(spfa())
        cout<<"No"<<endl;
    else 
        cout<<"Yes"<<endl;
    return 0;
}
```

#### è¯´æ˜

- ä¸€å¼€å§‹ä¸€å®šè¦ä¿è¯å°†æ‰€æœ‰é¡¶ç‚¹å‹å…¥é˜Ÿåˆ—ï¼Œå› ä¸ºå›¾å¯èƒ½æ˜¯ä¸è¿é€šçš„ã€‚å¦‚æœä¸è¿™æ ·çš„è¯ï¼Œå­˜åœ¨ä¸æºç‚¹ä¸è”é€šçš„è´Ÿæƒå›è·¯å°±ä¸ä¼šè¢«æ¢æµ‹å‡ºæ¥ï¼Œå…·ä½“å®ä¾‹å¯ä»¥çœ‹ä¸‹é¢è¿™å¼ å›¾ã€‚
  ![spfaåˆ¤æ–­è´Ÿæƒå›è·¯çš„åä¾‹](https://img-blog.csdnimg.cn/direct/66c922f62d6b4bbb873797deeb6a3c32.png#pic_center)
- è¿˜æœ‰ä¸€ç§æ›´ä¼˜åŒ–çš„æ–¹æ³•åˆ¤æ–­è´Ÿæƒå›è·¯ï¼Œç”±äºæˆ‘ç›®å‰çš„å®åŠ›æœ‰é™ï¼Œè¿˜æ²¡æœ‰çœ‹æ‡‚æ€è·¯ï¼Œæƒ³äº†è§£çš„ç«¥é‹å¯ä»¥çœ‹è¿™ä½å¤§ä½¬[KonaeAkira](https://konaeakira.github.io/)ã€‚
  
  > æ„Ÿè°¢å„ä½ç«¥é‹çœ‹åˆ°è¿™é‡Œï¼Œåé¢æˆ‘ä¼šæŒç»­æ›´æ–°æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶ç‚¹ç‚¹èµï¼Œæˆ‘ä»¬ä¸€èµ·è¿›æ­¥(âÂ´â—¡`â)
